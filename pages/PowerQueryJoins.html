<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Power Query Joins Playground</title>
  <style>
    :root {
      --bg: linear-gradient(180deg, #f4f7fb 0%, #eef2ff 100%);
      --panel: #ffffff;
      --ink: #0f172a;
      --muted: #475569;
      --accent: #2563eb;
      --accent-2: #22c55e;
      --shadow: rgba(15, 23, 42, 0.12);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
    }
    header {
      text-align: center;
      padding: 2.5rem 1rem 1rem;
    }
    h1 { margin: 0; font-size: 2.5rem; color: #0b1533; }
    .subtitle { margin-top: 0.5rem; color: var(--muted); font-size: 1.05rem; }
    .layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.25rem 2.5rem;
      display: grid;
      gap: 1.25rem;
      grid-template-columns: 360px 1fr;
    }
    .panel {
      background: var(--panel);
      border-radius: 16px;
      box-shadow: 0 16px 38px var(--shadow);
      border: 1px solid rgba(37, 99, 235, 0.12);
    }
    .controls { padding: 1.25rem; display: flex; flex-direction: column; gap: 1rem; }
    .controls h2 { margin: 0; font-size: 1.2rem; color: #0b1533; }
    .field { display: flex; flex-direction: column; gap: 0.35rem; }
    label { color: var(--muted); font-weight: 600; }
    select {
      padding: 0.75rem 0.85rem;
      border-radius: 12px;
      border: 1px solid rgba(37, 99, 235, 0.28);
      font-size: 0.98rem;
      background: #f8fafc;
      color: var(--ink);
    }
    .pill-row { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .pill {
      background: rgba(37, 99, 235, 0.08);
      border: 1px solid transparent;
      color: #0b1533;
      padding: 0.45rem 0.7rem;
      border-radius: 999px;
      font-size: 0.9rem;
      transition: all 0.18s ease;
      cursor: pointer;
    }
    .pill.active { border-color: rgba(37, 99, 235, 0.55); box-shadow: 0 8px 18px rgba(37,99,235,0.18); background: rgba(37,99,235,0.14); }
    .viz {
      padding: 1.25rem 1.5rem;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 1.25rem;
      align-items: center;
    }
    .venn {
      background: radial-gradient(circle at 30% 30%, rgba(37, 99, 235, 0.07), transparent 45%),
                  radial-gradient(circle at 70% 70%, rgba(34, 197, 94, 0.07), transparent 50%);
      border: 1px solid rgba(15, 23, 42, 0.06);
      border-radius: 18px;
      padding: 1rem;
    }
    svg { width: 100%; height: 280px; }
    .base-circle { fill: none; stroke: rgba(15, 23, 42, 0.22); stroke-width: 2.5; }
    .highlight { opacity: 0; transition: opacity 0.35s ease; }
    .highlight.show { opacity: 0.78; }
    .left-fill { fill: rgba(37, 99, 235, 0.5); }
    .right-fill { fill: rgba(34, 197, 94, 0.5); }
    .intersection-fill { fill: rgba(99, 102, 241, 0.75); }
    .legend { display: flex; gap: 0.9rem; flex-wrap: wrap; margin-top: 0.75rem; color: var(--muted); font-weight: 600; }
    .legend span { display: inline-flex; align-items: center; gap: 0.35rem; }
    .dot { width: 14px; height: 14px; border-radius: 50%; display: inline-block; }
    .tables { padding: 1.25rem; display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    table { width: 100%; border-collapse: collapse; background: #f8fafc; border-radius: 12px; overflow: hidden; }
    th, td { padding: 0.65rem 0.7rem; text-align: left; border-bottom: 1px solid rgba(15,23,42,0.06); }
    th { background: rgba(37, 99, 235, 0.08); color: #0b1533; font-size: 0.95rem; }
    td { color: #0f172a; font-size: 0.93rem; }
    .result-panel { padding: 1.25rem 1.5rem 1.5rem; }
    .result-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; }
    .tag { background: rgba(16,185,129,0.14); color: #065f46; padding: 0.25rem 0.65rem; border-radius: 12px; font-weight: 700; font-size: 0.9rem; }
    .sql-block { background: #0b1533; color: #e2e8f0; padding: 1rem; border-radius: 12px; margin-top: 1rem; font-family: "Cascadia Code", Consolas, monospace; font-size: 0.92rem; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05); }
    .note { margin-top: 0.75rem; color: var(--muted); }
    @media (max-width: 1024px) {
      .layout { grid-template-columns: 1fr; }
      .viz { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Power Query Joins (Orders, Customers, Products)</h1>
    <p class="subtitle">Toggle join types to see how Orders combine with Customers or Products, illustrated with Venn diagrams, live result tables, and matching SQL equivalents.</p>
  </header>
  <div class="layout">
    <section class="panel controls">
      <h2>Choose your scenario</h2>
      <div class="field">
        <label for="pairSelect">Tables to join</label>
        <div class="pill-row" id="pairSelect">
          <button class="pill active" data-pair="customers">Orders &amp; Customers</button>
          <button class="pill" data-pair="products">Orders &amp; Products</button>
        </div>
      </div>
      <div class="field">
        <label for="joinSelect">Join type</label>
        <select id="joinSelect">
          <option value="inner">Inner Join (matching rows only)</option>
          <option value="left">Left Outer Join (all Orders)</option>
          <option value="right">Right Outer Join (all from paired table)</option>
          <option value="full">Full Outer Join (everyone)</option>
          <option value="leftAnti">Left Anti Join (Orders without a match)</option>
          <option value="rightAnti">Right Anti Join (records in paired table without Orders)</option>
        </select>
      </div>
      <div class="field">
        <label>Quick prompts</label>
        <div class="pill-row">
          <span class="pill">Inner &rarr; Customers who placed an order</span>
          <span class="pill">Left Anti &rarr; Orders with missing Customer/Product</span>
          <span class="pill">Right Anti &rarr; Customers/Products waiting for their first order</span>
        </div>
      </div>
    </section>

    <section class="panel viz">
      <div class="venn">
        <svg viewBox="0 0 340 260" aria-labelledby="vennTitle" role="img">
          <title id="vennTitle">Venn diagram showing included regions of the join</title>
          <defs>
            <circle id="leftCircle" cx="130" cy="140" r="90"></circle>
            <circle id="rightCircle" cx="210" cy="140" r="90"></circle>
            <clipPath id="intersectionClip">
              <use href="#leftCircle" />
              <use href="#rightCircle" />
            </clipPath>
            <mask id="leftAntiMask">
              <rect width="100%" height="100%" fill="white" />
              <use href="#rightCircle" fill="black" />
            </mask>
            <mask id="rightAntiMask">
              <rect width="100%" height="100%" fill="white" />
              <use href="#leftCircle" fill="black" />
            </mask>
          </defs>
          <use href="#leftCircle" class="base-circle"></use>
          <use href="#rightCircle" class="base-circle"></use>

          <use href="#leftCircle" class="highlight left-fill" id="leftHighlight"></use>
          <use href="#rightCircle" class="highlight right-fill" id="rightHighlight"></use>
          <rect x="0" y="0" width="340" height="260" class="highlight left-fill" id="leftOnlyHighlight" mask="url(#leftAntiMask)"></rect>
          <rect x="0" y="0" width="340" height="260" class="highlight right-fill" id="rightOnlyHighlight" mask="url(#rightAntiMask)"></rect>
          <rect x="0" y="0" width="340" height="260" class="highlight intersection-fill" id="intersectionHighlight" clip-path="url(#intersectionClip)"></rect>
        </svg>
        <div class="legend">
          <span><span class="dot" style="background: rgba(37,99,235,0.6);"></span>Orders (Left)</span>
          <span><span class="dot" style="background: rgba(34,197,94,0.6);"></span>Customers / Products (Right)</span>
          <span><span class="dot" style="background: rgba(99,102,241,0.8);"></span>Included region</span>
        </div>
      </div>
      <div>
        <h2>Animated join story</h2>
        <p class="subtitle" style="margin-top:0;">Watch which records flow into the result set.</p>
        <div id="summaryCards" class="pill-row"></div>
        <p class="note">Both source tables stay visible below, along with the resulting rows.</p>
      </div>
    </section>
  </div>

  <section class="panel tables">
    <div>
      <h3>Orders (Left Table)</h3>
      <div id="ordersTable"></div>
    </div>
    <div>
      <h3 id="rightTitle">Customers (Right Table)</h3>
      <div id="rightTable"></div>
    </div>
  </section>

  <section class="panel result-panel">
    <div class="result-header">
      <div>
        <h2 id="resultTitle" style="margin:0;">Inner Join Result</h2>
        <p class="subtitle" id="resultSubtitle" style="margin:0.25rem 0 0;">Customers who placed an order.</p>
      </div>
      <span class="tag" id="rowCount">0 rows</span>
    </div>
    <div id="resultTable" style="margin-top: 1rem;"></div>
    <div class="sql-block" id="sqlBlock"></div>
  </section>

  <script>
    const orders = [
      { OrderID: 'O-9001', CustomerID: 'C001', ProductID: 'P100', Qty: 5 },
      { OrderID: 'O-9002', CustomerID: 'C002', ProductID: 'P101', Qty: 2 },
      { OrderID: 'O-9003', CustomerID: 'C003', ProductID: 'P103', Qty: 1 },
      { OrderID: 'O-9004', CustomerID: 'C001', ProductID: 'P102', Qty: 3 },
      { OrderID: 'O-9005', CustomerID: 'C002', ProductID: 'P105', Qty: 4 }
    ];

    const customers = [
      { CustomerID: 'C001', Name: 'Acme Retail', GSTNo: 'GST-09A', City: 'Delhi' },
      { CustomerID: 'C002', Name: 'North Star Traders', GSTNo: 'GST-22B', City: 'Mumbai' },
      { CustomerID: 'C003', Name: 'Future Mart', GSTNo: 'GST-31C', City: 'Hyderabad' },
      { CustomerID: 'C004', Name: 'First-Time Buyer Ltd.', GSTNo: 'GST-45D', City: 'Chennai' }
    ];

    const products = [
      { ProductID: 'P100', Name: 'Laptop Sleeve', HSNCode: '4202', Price: 32.00 },
      { ProductID: 'P101', Name: 'Mechanical Keyboard', HSNCode: '8471', Price: 95.00 },
      { ProductID: 'P102', Name: 'USB-C Hub', HSNCode: '8517', Price: 48.00 },
      { ProductID: 'P103', Name: '4K Monitor', HSNCode: '8528', Price: 280.00 },
      { ProductID: 'P104', Name: 'Wireless Mouse', HSNCode: '8471', Price: 25.00 }
    ];

    const rightColumns = {
      customers: [
        { key: 'CustomerID', label: 'Customer ID' },
        { key: 'Name', label: 'Customer Name' },
        { key: 'GSTNo', label: 'GST No' },
        { key: 'City', label: 'City' }
      ],
      products: [
        { key: 'ProductID', label: 'Product ID' },
        { key: 'Name', label: 'Product Name' },
        { key: 'HSNCode', label: 'HSN Code' },
        { key: 'Price', label: 'Price ($)' }
      ]
    };

    const resultColumns = {
      customers: [
        { key: 'OrderID', label: 'Order ID' },
        { key: 'CustomerID', label: 'Customer ID' },
        { key: 'CustomerName', label: 'Customer Name' },
        { key: 'GSTNo', label: 'GST No' },
        { key: 'ProductID', label: 'Product ID' },
        { key: 'Qty', label: 'Qty' }
      ],
      products: [
        { key: 'OrderID', label: 'Order ID' },
        { key: 'ProductID', label: 'Product ID' },
        { key: 'ProductName', label: 'Product Name' },
        { key: 'Price', label: 'Price ($)' },
        { key: 'CustomerID', label: 'Customer ID' },
        { key: 'Qty', label: 'Qty' }
      ]
    };

    const vennLayers = {
      left: document.getElementById('leftHighlight'),
      right: document.getElementById('rightHighlight'),
      leftOnly: document.getElementById('leftOnlyHighlight'),
      rightOnly: document.getElementById('rightOnlyHighlight'),
      intersection: document.getElementById('intersectionHighlight')
    };

    function buildTable(rows, columns) {
      const header = columns.map(col => `<th>${col.label}</th>`).join('');
      const body = rows.map(row => {
        const cells = columns.map(col => `<td>${row[col.key] ?? '—'}</td>`).join('');
        return `<tr>${cells}</tr>`;
      }).join('');
      return `<table><thead><tr>${header}</tr></thead><tbody>${body || '<tr><td colspan="'+columns.length+'">No rows</td></tr>'}</tbody></table>`;
    }

    function renderSourceTables(pair) {
      document.getElementById('ordersTable').innerHTML = buildTable(orders, [
        { key: 'OrderID', label: 'Order ID' },
        { key: 'CustomerID', label: 'Customer ID' },
        { key: 'ProductID', label: 'Product ID' },
        { key: 'Qty', label: 'Qty' }
      ]);
      document.getElementById('rightTitle').innerText = pair === 'customers' ? 'Customers (Right Table)' : 'Products (Right Table)';
      document.getElementById('rightTable').innerHTML = buildTable(pair === 'customers' ? customers : products, rightColumns[pair]);
    }

    function combineRows(leftRow, rightRow, pair) {
      const base = { OrderID: leftRow?.OrderID ?? '—', ProductID: leftRow?.ProductID ?? '—', CustomerID: leftRow?.CustomerID ?? '—', Qty: leftRow?.Qty ?? '—' };
      if (pair === 'customers') {
        return {
          ...base,
          CustomerName: rightRow?.Name ?? '—',
          GSTNo: rightRow?.GSTNo ?? '—'
        };
      }
      return {
        ...base,
        ProductName: rightRow?.Name ?? '—',
        Price: rightRow?.Price?.toFixed(2) ?? '—'
      };
    }

    function performJoin(joinType, pair) {
      const rightData = pair === 'customers' ? customers : products;
      const key = pair === 'customers' ? 'CustomerID' : 'ProductID';
      const rightMap = new Map();
      rightData.forEach(r => {
        const k = r[key];
        if (!rightMap.has(k)) rightMap.set(k, []);
        rightMap.get(k).push(r);
      });

      const results = [];
      const matchedRight = new Set();

      if (joinType === 'right' || joinType === 'rightAnti') {
        rightData.forEach(r => {
          const matches = orders.filter(o => o[key] === r[key]);
          if (matches.length) {
            matchedRight.add(r[key]);
            if (joinType === 'right') {
              matches.forEach(m => results.push(combineRows(m, r, pair)));
            }
          } else if (joinType === 'right' || joinType === 'rightAnti') {
            results.push(combineRows(null, r, pair));
          }
        });
        return results;
      }

      orders.forEach(o => {
        const matches = rightMap.get(o[key]) || [];
        if (matches.length) {
          matches.forEach(m => {
            matchedRight.add(m[key]);
            if (joinType !== 'leftAnti') results.push(combineRows(o, m, pair));
          });
        } else {
          if (joinType === 'left' || joinType === 'full' || joinType === 'leftAnti') {
            results.push(combineRows(o, null, pair));
          }
        }
      });

      if (joinType === 'full' || joinType === 'rightAnti') {
        rightData.forEach(r => {
          if (!matchedRight.has(r[key])) {
            results.push(combineRows(null, r, pair));
          }
        });
      }
      return results;
    }

    function updateVenn(joinType) {
      Object.values(vennLayers).forEach(layer => layer.classList.remove('show'));
      switch (joinType) {
        case 'inner':
          vennLayers.intersection.classList.add('show');
          break;
        case 'left':
          vennLayers.leftOnly.classList.add('show');
          vennLayers.intersection.classList.add('show');
          break;
        case 'right':
          vennLayers.rightOnly.classList.add('show');
          vennLayers.intersection.classList.add('show');
          break;
        case 'full':
          vennLayers.leftOnly.classList.add('show');
          vennLayers.rightOnly.classList.add('show');
          vennLayers.intersection.classList.add('show');
          break;
        case 'leftAnti':
          vennLayers.leftOnly.classList.add('show');
          break;
        case 'rightAnti':
          vennLayers.rightOnly.classList.add('show');
          break;
      }
    }

    function updateSummary(joinType, pair, rowCount) {
      const summary = document.getElementById('summaryCards');
      const phrases = {
        inner: 'Only matching records from both tables',
        left: 'All Orders plus any matching '+(pair==='customers'?'Customers':'Products'),
        right: 'All '+(pair==='customers'?'Customers':'Products')+' plus matching Orders',
        full: 'Everything from both sides with matches where possible',
        leftAnti: 'Orders that failed to match the right table',
        rightAnti: (pair==='customers'?'Customers':'Products')+' that have not appeared in Orders yet'
      };
      summary.innerHTML = [
        `<span class="pill active">${phrases[joinType]}</span>`,
        `<span class="pill">${rowCount} row(s) returned</span>`
      ].join('');
      document.getElementById('resultTitle').innerText = `${joinSelect.options[joinSelect.selectedIndex].text}`;
      document.getElementById('resultSubtitle').innerText = phrases[joinType];
      document.getElementById('rowCount').innerText = `${rowCount} row${rowCount === 1 ? '' : 's'}`;
    }

    function buildSql(joinType, pair) {
      const rightName = pair === 'customers' ? 'Customers' : 'Products';
      const key = pair === 'customers' ? 'CustomerID' : 'ProductID';
      const selectCols = pair === 'customers'
        ? 'o.OrderID, o.CustomerID, c.Name, c.GSTNo, o.ProductID, o.Qty'
        : 'o.OrderID, o.ProductID, p.Name, p.Price, o.CustomerID, o.Qty';
      const base = `SELECT ${selectCols}\nFROM Orders o`;
      const joinKeyword = {
        inner: 'INNER JOIN',
        left: 'LEFT OUTER JOIN',
        right: 'RIGHT OUTER JOIN',
        full: 'FULL OUTER JOIN',
        leftAnti: 'LEFT OUTER JOIN',
        rightAnti: 'RIGHT OUTER JOIN'
      }[joinType];
      const alias = pair === 'customers' ? 'c' : 'p';
      let sql = `${base}\n${joinKeyword} ${rightName} ${alias}\n  ON o.${key} = ${alias}.${key}`;
      if (joinType === 'leftAnti') sql += `\nWHERE ${alias}.${key} IS NULL`;
      if (joinType === 'rightAnti') sql += `\nWHERE o.${key} IS NULL`;
      return sql;
    }

    function refresh() {
      const pair = document.querySelector('#pairSelect .active').dataset.pair;
      const joinType = document.getElementById('joinSelect').value;
      renderSourceTables(pair);
      const result = performJoin(joinType, pair);
      updateVenn(joinType);
      updateSummary(joinType, pair, result.length);
      document.getElementById('resultTable').innerHTML = buildTable(result, resultColumns[pair]);
      document.getElementById('sqlBlock').innerText = buildSql(joinType, pair);
    }

    document.getElementById('pairSelect').addEventListener('click', (e) => {
      if (e.target.matches('button')) {
        document.querySelectorAll('#pairSelect .pill').forEach(p => p.classList.remove('active'));
        e.target.classList.add('active');
        const joinSelect = document.getElementById('joinSelect');
        if (e.target.dataset.pair === 'products' && joinSelect.value === 'rightAnti') {
          joinSelect.value = 'inner';
        }
        refresh();
      }
    });

    const joinSelect = document.getElementById('joinSelect');
    joinSelect.addEventListener('change', refresh);

    // initial render
    refresh();
  </script>
</body>
</html>
